{%- comment -%}
  ==========================================
  üè¢ PROFESSIONAL HEADER SYSTEM
  ==========================================
  Clean, semantic, and performant header component
  
  Architecture:
  - Component-based design with clear separation of concerns
  - Modern semantic HTML5 structure  
  - Accessibility-first approach (WCAG 2.1 AA)
  - Performance-optimized resource loading
  - Maintainable and scalable codebase
  
  @version 3.0.0 - Professional Rebuild
  @author Professional Development Team
{%- endcomment -%}

{%- comment -%} ===============================================
    CONFIGURATION & SETUP
=============================================== {%- endcomment -%}

{%- liquid
  # Core Configuration
  assign enable_sticky_header = section.settings.enable_sticky_header | default: false
  assign logo_position = section.settings.logo_position | default: 'left'
  assign menu_handle = section.settings.menu | default: 'main-menu'
  assign enable_search = section.settings.enable_search | default: true
  assign enable_cart = section.settings.enable_cart | default: true
  assign enable_account = section.settings.enable_account | default: true
  
  # Responsive Configuration
  assign mobile_breakpoint = 990
  assign logo_width_desktop = section.settings.logo_width | default: 140
  assign logo_width_mobile = section.settings.logo_width_mobile | default: 110
  
  # Feature Detection - Simplified
  if linklists[menu_handle].links.size > 0
    assign has_menu = true
  else
    assign has_menu = false
  endif
  
  if localization.available_countries.size > 1 or localization.available_languages.size > 1
    assign has_localization = true
  else
    assign has_localization = false
  endif
  
  assign has_customer_accounts = shop.customer_accounts_enabled
  
  # Performance Optimization
  assign critical_css_inline = section.settings.inline_critical_css | default: true
  assign preload_logo = section.settings.preload_logo | default: true
-%}

{%- comment -%} ===============================================
    CRITICAL CSS (INLINE FOR PERFORMANCE)
=============================================== {%- endcomment -%}

{%- if critical_css_inline -%}
<style>
  /* Critical Header CSS - Inline for performance */
  .header-professional {
    position: relative;
    z-index: 100;
    background: rgb(var(--color-background));
    border-bottom: 1px solid rgba(var(--color-foreground), 0.1);
  }
  
  .header-professional__container {
    display: grid;
    grid-template-columns: auto 1fr auto;
    align-items: center;
    gap: 1rem;
    max-width: var(--page-width);
    margin: 0 auto;
    padding: 1rem var(--page-width-margin);
    min-height: 60px;
  }
  
  .header-professional__logo img {
    max-width: {{ logo_width_desktop }}px;
    height: auto;
  }
  
  .header-professional__navigation {
    justify-self: {% if logo_position == 'center' %}center{% else %}start{% endif %};
  }
  
  .header-professional__utilities {
    display: flex;
    align-items: center;
    gap: 1rem;
  }
  
  /* Mobile Critical Styles */
  @media screen and (max-width: {{ mobile_breakpoint | minus: 1 }}px) {
    .header-professional__logo img {
      max-width: {{ logo_width_mobile }}px;
    }
    
    .header-professional__navigation {
      display: none;
    }
    
    .header-professional__utilities {
      gap: 0.5rem;
    }
  }
</style>
{%- endif -%}

{%- comment -%} ===============================================
    STRUCTURED DATA FOR SEO
=============================================== {%- endcomment -%}

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": {{ shop.name | json }},
  {% if section.settings.logo %}
    "logo": {{ section.settings.logo | image_url: width: 500 | prepend: "https:" | json }},
  {% endif %}
  "url": {{ request.origin | json }},
  "sameAs": [
    {% if settings.social_facebook_link != blank %}"{{ settings.social_facebook_link }}"{% endif %}
    {% if settings.social_twitter_link != blank %}{% if settings.social_facebook_link != blank %},{% endif %}"{{ settings.social_twitter_link }}"{% endif %}
    {% if settings.social_instagram_link != blank %}{% if settings.social_facebook_link != blank or settings.social_twitter_link != blank %},{% endif %}"{{ settings.social_instagram_link }}"{% endif %}
  ]
}
</script>

{%- comment -%} ===============================================
    HEADER MARKUP - SEMANTIC HTML5
=============================================== {%- endcomment -%}

<header 
  class="header-professional{% if enable_sticky_header %} header-professional--sticky{% endif %} color-{{ section.settings.color_scheme | default: 'background-1' }}"
  role="banner"
  {% if enable_sticky_header %}data-sticky-header{% endif %}
>
  <div class="header-professional__container">
    
    {%- comment -%} ===============================================
        LOGO SECTION
    =============================================== {%- endcomment -%}
    
    <div class="header-professional__logo">
      {% render 'header-logo', 
        logo: section.settings.logo,
        logo_mobile: section.settings.logo_mobile,
        logo_width: logo_width_desktop,
        logo_width_mobile: logo_width_mobile,
        preload: preload_logo
      %}
    </div>

    {%- comment -%} ===============================================
        NAVIGATION SECTION
    =============================================== {%- endcomment -%}
    
    {%- if has_menu -%}
      <nav class="header-professional__navigation" role="navigation" aria-label="{{ 'sections.header.menu' | t }}">
        {% render 'header-navigation',
          menu_handle: menu_handle,
          enable_dropdowns: section.settings.enable_dropdowns,
          dropdown_style: section.settings.dropdown_style
        %}
      </nav>
    {%- endif -%}

    {%- comment -%} ===============================================
        UTILITIES SECTION (Search, Account, Cart)
    =============================================== {%- endcomment -%}
    
    <div class="header-professional__utilities">
      {% render 'header-utilities',
        enable_search: enable_search,
        enable_account: enable_account,
        enable_cart: enable_cart,
        has_customer_accounts: has_customer_accounts,
        enable_localization: has_localization,
        mobile_menu_handle: menu_handle
      %}
    </div>
  </div>

  {%- comment -%} Mobile Menu Drawer - Use existing header drawer {%- endcomment -%}
  {%- if has_menu -%}
    {% render 'header-drawer', 
      menu: linklists[menu_handle]
    %}
  {%- endif -%}
</header>

{%- comment -%} ===============================================
    CART NOTIFICATION (if enabled)
=============================================== {%- endcomment -%}

{%- if settings.cart_type == "notification" -%}
  {% render 'cart-notification', color_scheme: section.settings.color_scheme %}
{%- endif -%}

{%- comment -%} ===============================================
    PERFORMANCE-OPTIMIZED RESOURCE LOADING
=============================================== {%- endcomment -%}

{%- unless critical_css_inline -%}
  <link rel="stylesheet" href="{{ 'header-professional.css' | asset_url }}" media="print" onload="this.media='all'">
  <noscript><link rel="stylesheet" href="{{ 'header-professional.css' | asset_url }}"></noscript>
{%- endunless -%}

<script src="{{ 'header-clean.js' | asset_url }}" defer></script>

{%- comment -%} ===============================================
    STICKY HEADER COMPONENT
=============================================== {%- endcomment -%}

{%- if enable_sticky_header -%}
  <script type="module">
    class StickyHeader extends HTMLElement {
      constructor() {
        super();
        this.header = this.querySelector('.header-professional');
        this.headerBounds = {};
        this.currentScrollY = 0;
        this.preventReveal = false;
        
        this.onScrollHandler = this.onScroll.bind(this);
        this.hideHeaderOnScrollUp = () => this.preventReveal = true;
        this.revealHeaderOnScrollDown = () => this.preventReveal = false;
        
        this.addEventListener('preventHeaderReveal', this.hideHeaderOnScrollUp);
        this.addEventListener('allowHeaderReveal', this.revealHeaderOnScrollDown);
      }

      connectedCallback() {
        this.headerBounds = this.header.getBoundingClientRect();
        this.setHeaderHeight();
        
        window.matchMedia('(max-width: {{ mobile_breakpoint | minus: 1 }}px)').addEventListener('change', this.setHeaderHeight.bind(this));
        
        if (this.dataset.stickyType === 'reduce-logo-size') {
          this.reduceLogo();
        }
        
        setTimeout(() => {
          this.createObserver();
        });
      }

      setHeaderHeight() {
        document.documentElement.style.setProperty('--header-height', `${this.header.offsetHeight}px`);
      }

      createObserver() {
        this.observer = new IntersectionObserver((entries) => {
          this.headerBounds = entries[0].intersectionRect;
          this.observer.unobserve(this.header);
        });
        this.observer.observe(this.header);
      }

      onScroll() {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        
        if (scrollTop > this.currentScrollY && scrollTop > this.headerBounds.bottom) {
          this.hide();
        } else if (scrollTop < this.currentScrollY && scrollTop > this.headerBounds.bottom && !this.preventReveal) {
          this.reveal();
        } else if (scrollTop <= this.headerBounds.top) {
          this.reset();
        }
        
        this.currentScrollY = scrollTop;
      }

      hide() {
        if (this.header.classList.contains('header-professional--hidden')) return;
        this.header.classList.add('header-professional--hidden');
        this.header.classList.remove('header-professional--sticky');
      }

      reveal() {
        if (!this.header.classList.contains('header-professional--hidden')) return;
        this.header.classList.add('header-professional--sticky');
        this.header.classList.remove('header-professional--hidden');
      }

      reset() {
        this.header.classList.remove('header-professional--hidden', 'header-professional--sticky');
      }

      reduceLogo() {
        const logo = this.header.querySelector('.header-professional__logo img');
        if (logo) {
          const observer = new IntersectionObserver((entries) => {
            if (entries[0].isIntersecting) {
              logo.style.maxWidth = '{{ logo_width_desktop }}px';
            } else {
              logo.style.maxWidth = '{{ logo_width_mobile }}px';
            }
          });
          observer.observe(this);
        }
      }

      disconnectedCallback() {
        this.removeEventListener('preventHeaderReveal', this.hideHeaderOnScrollUp);
        this.removeEventListener('allowHeaderReveal', this.revealHeaderOnScrollDown);
        window.removeEventListener('scroll', this.onScrollHandler);
      }
    }

    customElements.define('sticky-header', StickyHeader);

    // Initialize sticky header
    document.addEventListener('DOMContentLoaded', () => {
      const stickyHeader = document.querySelector('[data-sticky-header]');
      if (stickyHeader) {
        window.addEventListener('scroll', stickyHeader.onScrollHandler, { passive: true });
      }
    });
  </script>
{%- endif -%}

{%- comment -%} ===============================================
    SCHEMA SETTINGS
=============================================== {%- endcomment -%}

{% schema %}
{
  "name": "üè¢ Professional Header",
  "class": "header-professional-section",
  "settings": [
    {
      "type": "header",
      "content": "üéØ Header Configuration"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "background-1"
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo image"
    },
    {
      "type": "image_picker", 
      "id": "logo_mobile",
      "label": "Mobile logo (optional)",
      "info": "Uses main logo if not set"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 50,
      "max": 300,
      "step": 10,
      "default": 140,
      "unit": "px",
      "label": "Desktop logo width"
    },
    {
      "type": "range",
      "id": "logo_width_mobile", 
      "min": 50,
      "max": 200,
      "step": 10,
      "default": 110,
      "unit": "px",
      "label": "Mobile logo width"
    },
    {
      "type": "select",
      "id": "logo_position",
      "label": "Logo position",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center", 
          "label": "Center"
        }
      ],
      "default": "left"
    },
    {
      "type": "header",
      "content": "üß≠ Navigation"
    },
    {
      "type": "link_list",
      "id": "menu",
      "default": "main-menu",
      "label": "Menu"
    },
    {
      "type": "checkbox",
      "id": "enable_dropdowns",
      "default": true,
      "label": "Enable dropdown menus"
    },
    {
      "type": "select",
      "id": "dropdown_style",
      "label": "Dropdown style",
      "options": [
        {
          "value": "minimal",
          "label": "Minimal"
        },
        {
          "value": "styled",
          "label": "Styled"
        },
        {
          "value": "card",
          "label": "Card style"
        }
      ],
      "default": "styled"
    },
    {
      "type": "header",
      "content": "üîç Search & Features"
    },
    {
      "type": "checkbox",
      "id": "enable_search",
      "default": true,
      "label": "Show search"
    },
    {
      "type": "checkbox",
      "id": "enable_cart",
      "default": true,
      "label": "Show cart"
    },
    {
      "type": "checkbox",
      "id": "enable_account",
      "default": true,
      "label": "Show customer account"
    },
    {
      "type": "checkbox",
      "id": "enable_localization",
      "default": true,
      "label": "Show country/language selector"
    },
    {
      "type": "header",
      "content": "üì± Mobile & Responsive"
    },
    {
      "type": "checkbox",
      "id": "enable_sticky_header",
      "default": false,
      "label": "Sticky header on scroll"
    },
    {
      "type": "select",
      "id": "sticky_header_type",
      "label": "Sticky header behavior",
      "options": [
        {
          "value": "always",
          "label": "Always show"
        },
        {
          "value": "scroll-up",
          "label": "Show on scroll up"
        },
        {
          "value": "reduce-logo-size",
          "label": "Reduce logo size"
        }
      ],
      "default": "scroll-up"
    },
    {
      "type": "header",
      "content": "‚ö° Performance"
    },
    {
      "type": "checkbox",
      "id": "inline_critical_css",
      "default": true,
      "label": "Inline critical CSS",
      "info": "Improves loading performance"
    },
    {
      "type": "checkbox",
      "id": "preload_logo",
      "default": true,
      "label": "Preload logo image",
      "info": "Prioritizes logo loading"
    }
  ]
}
{% endschema %}