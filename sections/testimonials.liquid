{{ 'section-testimonials.css' | asset_url | stylesheet_tag }}
{{ 'component-slider.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  .testimonials-section-{{ section.id }} {
    {% if section.settings.background_color != blank and section.settings.background_color != 'rgba(0,0,0,0)' %}
      background-color: {{ section.settings.background_color }};
    {% endif %}
    {% if section.settings.background_image %}
      background-image: url('{{ section.settings.background_image | image_url: width: 1920 }}');
      background-size: cover;
      background-position: center;
      position: relative;
    {% endif %}
    border-radius: {{ section.settings.border_radius }}px;
    overflow: hidden;
  }

  .testimonials-overlay-{{ section.id }} {
    {% if section.settings.background_image and section.settings.overlay_opacity > 0 %}
      background-color: rgba(0, 0, 0, {{ section.settings.overlay_opacity | divided_by: 100.0 }});
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 1;
    {% endif %}
  }

  .testimonials-content-{{ section.id }} {
    position: relative;
    z-index: 2;
  }

  .testimonials-container-{{ section.id }} {
    max-width: {% case section.settings.container_width %}
      {% when 'narrow' %}750px
      {% when 'standard' %}1200px
      {% when 'wide' %}1600px
      {% else %}100%
    {% endcase %};
    margin: 0 auto;
    padding: 0 {% if section.settings.container_width == 'full' %}0{% else %}2rem{% endif %};
  }

  .testimonials-grid-{{ section.id }} {
    display: grid;
    grid-template-columns: repeat({{ section.settings.columns_desktop }}, 1fr);
    gap: {{ section.settings.card_spacing }}px;
  }

  @media screen and (max-width: 989px) {
    .testimonials-grid-{{ section.id }} {
      grid-template-columns: repeat({{ section.settings.columns_tablet }}, 1fr);
    }
  }

  @media screen and (max-width: 749px) {
    .testimonials-grid-{{ section.id }} {
      grid-template-columns: 1fr;
    }
  }

  .testimonial-card-{{ section.id }} {
    background: {% if section.settings.card_background %}rgba(var(--color-background), 0.95){% else %}transparent{% endif %};
    border: {% if section.settings.show_borders %}1px solid rgba(var(--color-foreground), 0.1){% else %}none{% endif %};
    border-radius: {{ section.settings.card_border_radius }}px;
    padding: {{ section.settings.card_padding }}px;
    text-align: {{ section.settings.text_alignment }};
    position: relative;
    transition: all 0.3s ease;
    {% if section.settings.card_shadow %}
      box-shadow: 0 4px 12px rgba(var(--color-shadow), 0.1);
    {% endif %}
  }

  .testimonial-card-{{ section.id }}:hover {
    {% if section.settings.hover_effect == 'lift' %}
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(var(--color-shadow), 0.15);
    {% elsif section.settings.hover_effect == 'scale' %}
      transform: scale(1.02);
    {% elsif section.settings.hover_effect == 'glow' %}
      box-shadow: 0 0 0 2px rgba(var(--color-button), 0.3);
    {% endif %}
  }

  .testimonial-quote-{{ section.id }} {
    font-size: {{ section.settings.quote_font_size }}px;
    line-height: 1.5;
    margin-bottom: 1.5rem;
    font-style: {% if section.settings.quote_italic %}italic{% else %}normal{% endif %};
    position: relative;
  }

  .testimonial-quote-{{ section.id }}::before {
    {% if section.settings.show_quote_marks %}
      content: '"';
      font-size: 3em;
      color: rgba(var(--color-foreground), 0.3);
      position: absolute;
      top: -10px;
      left: {% if section.settings.text_alignment == 'center' %}-20px{% elsif section.settings.text_alignment == 'right' %}-40px{% else %}0{% endif %};
      line-height: 1;
    {% endif %}
  }

  .testimonial-author-{{ section.id }} {
    margin-top: auto;
  }

  .testimonial-avatar-{{ section.id }} {
    width: {{ section.settings.avatar_size }}px;
    height: {{ section.settings.avatar_size }}px;
    border-radius: {% if section.settings.avatar_style == 'circle' %}50%{% else %}{{ section.settings.card_border_radius }}px{% endif %};
    object-fit: cover;
    margin: {% if section.settings.text_alignment == 'center' %}0 auto 1rem{% elsif section.settings.text_alignment == 'right' %}0 0 1rem auto{% else %}0 1rem 1rem 0{% endif %};
    {% if section.settings.avatar_border %}
      border: 3px solid rgba(var(--color-button), 0.5);
    {% endif %}
  }

  .testimonial-name-{{ section.id }} {
    font-weight: {{ section.settings.name_font_weight }};
    font-size: {{ section.settings.name_font_size }}px;
    margin-bottom: 0.25rem;
  }

  .testimonial-title-{{ section.id }} {
    color: rgba(var(--color-foreground), 0.7);
    font-size: {{ section.settings.title_font_size }}px;
  }

  .testimonial-rating-{{ section.id }} {
    margin-bottom: 1rem;
    color: var(--color-button);
  }

  .testimonial-star {
    font-size: {{ section.settings.star_size }}px;
  }

  .slider-testimonials-{{ section.id }} {
    overflow: hidden;
    position: relative;
  }

  .slider-track-{{ section.id }} {
    display: flex;
    transition: transform 0.5s ease;
  }

  .slider-slide-{{ section.id }} {
    min-width: 100%;
    flex-shrink: 0;
  }

  .slider-controls-{{ section.id }} {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
    margin-top: 2rem;
  }

  .slider-button-{{ section.id }} {
    background: rgba(var(--color-button), 1);
    color: rgb(var(--color-button-text));
    border: none;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
  }

  .slider-button-{{ section.id }}:hover {
    background: rgba(var(--color-button), 0.8);
    transform: scale(1.1);
  }

  .slider-dots-{{ section.id }} {
    display: flex;
    gap: 0.5rem;
  }

  .slider-dot-{{ section.id }} {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: rgba(var(--color-foreground), 0.3);
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .slider-dot-{{ section.id }}.active {
    background: rgba(var(--color-button), 1);
    transform: scale(1.2);
  }

  @media screen and (max-width: 749px) {
    .testimonials-grid-{{ section.id }} {
      gap: {{ section.settings.card_spacing | divided_by: 2 }}px;
    }
    
    .testimonial-card-{{ section.id }} {
      padding: {{ section.settings.card_padding | times: 0.75 }}px;
    }
  }
{%- endstyle -%}

<div class="testimonials-section testimonials-section-{{ section.id }} color-{{ section.settings.color_scheme }} gradient section-{{ section.id }}-padding{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}">
  <div class="testimonials-overlay-{{ section.id }}"></div>
  
  <div class="testimonials-content-{{ section.id }}">
    <div class="testimonials-container-{{ section.id }}">
      {% if section.settings.section_title != blank or section.settings.section_subtitle != blank %}
        <div class="testimonials-header text-{{ section.settings.header_alignment }}{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}">
          {% if section.settings.section_title != blank %}
            <h2 class="testimonials-title {{ section.settings.heading_size }}">
              {{ section.settings.section_title }}
            </h2>
          {% endif %}
          {% if section.settings.section_subtitle != blank %}
            <div class="testimonials-subtitle rte">
              {{ section.settings.section_subtitle }}
            </div>
          {% endif %}
        </div>
      {% endif %}

      {% if section.settings.layout == 'slider' and section.blocks.size > 1 %}
        <div class="slider-testimonials-{{ section.id }}">
          <div class="slider-track-{{ section.id }}" id="sliderTrack{{ section.id }}">
            {% for block in section.blocks %}
              <div class="slider-slide-{{ section.id }}">
                {% render 'testimonial-card', block: block, section_id: section.id %}
              </div>
            {% endfor %}
          </div>
          
          {% if section.settings.show_controls %}
            <div class="slider-controls-{{ section.id }}">
              <button class="slider-button-{{ section.id }}" onclick="prevSlide{{ section.id }}()">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M10 2L4 8l6 6" stroke="currentColor" stroke-width="2" fill="none"/>
                </svg>
              </button>
              
              {% if section.settings.show_dots %}
                <div class="slider-dots-{{ section.id }}">
                  {% for block in section.blocks %}
                    <div class="slider-dot-{{ section.id }}{% if forloop.first %} active{% endif %}" 
                         onclick="goToSlide{{ section.id }}({{ forloop.index0 }})"></div>
                  {% endfor %}
                </div>
              {% endif %}
              
              <button class="slider-button-{{ section.id }}" onclick="nextSlide{{ section.id }}()">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M6 2l6 6-6 6" stroke="currentColor" stroke-width="2" fill="none"/>
                </svg>
              </button>
            </div>
          {% endif %}
        </div>
      {% else %}
        <div class="testimonials-grid-{{ section.id }}">
          {% for block in section.blocks %}
            {% render 'testimonial-card', block: block, section_id: section.id %}
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>
</div>

{% if section.settings.layout == 'slider' and section.blocks.size > 1 %}
<script>
(function() {
  let currentSlide{{ section.id }} = 0;
  const totalSlides{{ section.id }} = {{ section.blocks.size }};
  const track{{ section.id }} = document.getElementById('sliderTrack{{ section.id }}');
  const dots{{ section.id }} = document.querySelectorAll('.slider-dot-{{ section.id }}');
  
  function updateSlider{{ section.id }}() {
    if (track{{ section.id }}) {
      track{{ section.id }}.style.transform = `translateX(-${currentSlide{{ section.id }} * 100}%)`;
    }
    
    dots{{ section.id }}.forEach((dot, index) => {
      dot.classList.toggle('active', index === currentSlide{{ section.id }});
    });
  }
  
  window.nextSlide{{ section.id }} = function() {
    currentSlide{{ section.id }} = (currentSlide{{ section.id }} + 1) % totalSlides{{ section.id }};
    updateSlider{{ section.id }}();
  };
  
  window.prevSlide{{ section.id }} = function() {
    currentSlide{{ section.id }} = (currentSlide{{ section.id }} - 1 + totalSlides{{ section.id }}) % totalSlides{{ section.id }};
    updateSlider{{ section.id }}();
  };
  
  window.goToSlide{{ section.id }} = function(index) {
    currentSlide{{ section.id }} = index;
    updateSlider{{ section.id }}();
  };
  
  {% if section.settings.auto_play %}
  setInterval(() => {
    nextSlide{{ section.id }}();
  }, {{ section.settings.auto_play_speed | times: 1000 }});
  {% endif %}
})();
</script>
{% endif %}

{% schema %}
{
  "name": "Testimonials",
  "tag": "section",
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "text",
      "id": "section_title",
      "default": "What Our Customers Say",
      "label": "Section title"
    },
    {
      "type": "select",
      "id": "heading_size",
      "options": [
        {
          "value": "h2",
          "label": "Small"
        },
        {
          "value": "h1",
          "label": "Medium"
        },
        {
          "value": "h0",
          "label": "Large"
        }
      ],
      "default": "h1",
      "label": "Title size"
    },
    {
      "type": "richtext",
      "id": "section_subtitle",
      "label": "Section subtitle"
    },
    {
      "type": "select",
      "id": "header_alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "center",
      "label": "Header alignment"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "layout",
      "options": [
        {
          "value": "grid",
          "label": "Grid"
        },
        {
          "value": "slider",
          "label": "Slider"
        }
      ],
      "default": "grid",
      "label": "Layout style"
    },
    {
      "type": "select",
      "id": "container_width",
      "options": [
        {
          "value": "narrow",
          "label": "Narrow"
        },
        {
          "value": "standard",
          "label": "Standard"
        },
        {
          "value": "wide",
          "label": "Wide"
        },
        {
          "value": "full",
          "label": "Full width"
        }
      ],
      "default": "standard",
      "label": "Container width"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 1,
      "max": 4,
      "step": 1,
      "default": 3,
      "label": "Desktop columns"
    },
    {
      "type": "range",
      "id": "columns_tablet",
      "min": 1,
      "max": 3,
      "step": 1,
      "default": 2,
      "label": "Tablet columns"
    },
    {
      "type": "range",
      "id": "card_spacing",
      "min": 8,
      "max": 40,
      "step": 4,
      "unit": "px",
      "default": 24,
      "label": "Card spacing"
    },
    {
      "type": "header",
      "content": "Card Styling"
    },
    {
      "type": "checkbox",
      "id": "card_background",
      "default": true,
      "label": "Show card background"
    },
    {
      "type": "checkbox",
      "id": "show_borders",
      "default": true,
      "label": "Show card borders"
    },
    {
      "type": "checkbox",
      "id": "card_shadow",
      "default": true,
      "label": "Show card shadow"
    },
    {
      "type": "range",
      "id": "card_border_radius",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "default": 12,
      "label": "Card border radius"
    },
    {
      "type": "range",
      "id": "card_padding",
      "min": 16,
      "max": 40,
      "step": 4,
      "unit": "px",
      "default": 24,
      "label": "Card padding"
    },
    {
      "type": "select",
      "id": "hover_effect",
      "options": [
        {
          "value": "none",
          "label": "None"
        },
        {
          "value": "lift",
          "label": "Lift effect"
        },
        {
          "value": "scale",
          "label": "Scale effect"
        },
        {
          "value": "glow",
          "label": "Glow effect"
        }
      ],
      "default": "lift",
      "label": "Hover effect"
    },
    {
      "type": "header",
      "content": "Content Styling"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "center",
      "label": "Text alignment"
    },
    {
      "type": "checkbox",
      "id": "show_quote_marks",
      "default": true,
      "label": "Show quote marks"
    },
    {
      "type": "checkbox",
      "id": "quote_italic",
      "default": true,
      "label": "Italic quote text"
    },
    {
      "type": "range",
      "id": "quote_font_size",
      "min": 14,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 16,
      "label": "Quote font size"
    },
    {
      "type": "header",
      "content": "Author Styling"
    },
    {
      "type": "range",
      "id": "avatar_size",
      "min": 40,
      "max": 80,
      "step": 4,
      "unit": "px",
      "default": 60,
      "label": "Avatar size"
    },
    {
      "type": "select",
      "id": "avatar_style",
      "options": [
        {
          "value": "circle",
          "label": "Circle"
        },
        {
          "value": "rounded",
          "label": "Rounded"
        }
      ],
      "default": "circle",
      "label": "Avatar style"
    },
    {
      "type": "checkbox",
      "id": "avatar_border",
      "default": false,
      "label": "Show avatar border"
    },
    {
      "type": "range",
      "id": "name_font_size",
      "min": 14,
      "max": 20,
      "step": 1,
      "unit": "px",
      "default": 16,
      "label": "Name font size"
    },
    {
      "type": "select",
      "id": "name_font_weight",
      "options": [
        {
          "value": "400",
          "label": "Normal"
        },
        {
          "value": "500",
          "label": "Medium"
        },
        {
          "value": "600",
          "label": "Semi Bold"
        },
        {
          "value": "700",
          "label": "Bold"
        }
      ],
      "default": "600",
      "label": "Name font weight"
    },
    {
      "type": "range",
      "id": "title_font_size",
      "min": 12,
      "max": 18,
      "step": 1,
      "unit": "px",
      "default": 14,
      "label": "Title font size"
    },
    {
      "type": "header",
      "content": "Rating"
    },
    {
      "type": "range",
      "id": "star_size",
      "min": 14,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 18,
      "label": "Star size"
    },
    {
      "type": "header",
      "content": "Slider Settings"
    },
    {
      "type": "checkbox",
      "id": "show_controls",
      "default": true,
      "label": "Show slider controls"
    },
    {
      "type": "checkbox",
      "id": "show_dots",
      "default": true,
      "label": "Show dots"
    },
    {
      "type": "checkbox",
      "id": "auto_play",
      "default": false,
      "label": "Auto play"
    },
    {
      "type": "range",
      "id": "auto_play_speed",
      "min": 3,
      "max": 10,
      "step": 1,
      "unit": "s",
      "default": 5,
      "label": "Auto play speed"
    },
    {
      "type": "header",
      "content": "Background"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color"
    },
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "Background image"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "min": 0,
      "max": 80,
      "step": 5,
      "unit": "%",
      "default": 20,
      "label": "Background overlay opacity"
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 50,
      "step": 2,
      "unit": "px",
      "default": 0,
      "label": "Section border radius"
    },
    {
      "type": "header",
      "content": "Section padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "Top padding",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding",
      "default": 36
    }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "settings": [
        {
          "type": "richtext",
          "id": "quote",
          "default": "<p>This product exceeded my expectations. Great quality and fast shipping!</p>",
          "label": "Quote"
        },
        {
          "type": "image_picker",
          "id": "avatar",
          "label": "Customer photo"
        },
        {
          "type": "text",
          "id": "name",
          "default": "Customer Name",
          "label": "Customer name"
        },
        {
          "type": "text",
          "id": "title",
          "default": "Verified Customer",
          "label": "Customer title"
        },
        {
          "type": "range",
          "id": "rating",
          "min": 1,
          "max": 5,
          "step": 1,
          "default": 5,
          "label": "Rating (stars)"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Testimonials",
      "blocks": [
        {
          "type": "testimonial",
          "settings": {
            "quote": "<p>Amazing product quality! I've been using this for months and it's still in perfect condition. Highly recommend!</p>",
            "name": "Sarah Johnson",
            "title": "Verified Customer",
            "rating": 5
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "quote": "<p>Fast shipping and excellent customer service. The team went above and beyond to help me find the right product.</p>",
            "name": "Michael Chen",
            "title": "Repeat Customer",
            "rating": 5
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "quote": "<p>Great value for money. The quality is outstanding and it arrived exactly as described. Will definitely shop here again!</p>",
            "name": "Emma Davis",
            "title": "Verified Customer",
            "rating": 4
          }
        }
      ]
    }
  ]
}
{% endschema %}
