{% comment %}
  Mobile Bottom Navigation
  Renders a fixed bottom navigation for mobile devices with Home, Cart, Search, and Account links
  
  Settings controlled from Theme Customizer → Header → Mobile Navigation Settings
{% endcomment %}

{% comment %} Get settings from theme customizer {% endcomment %}
{% assign nav_enabled = sections.header.settings.enable_mobile_navigation | default: true %}
{% assign nav_style = sections.header.settings.mobile_nav_style | default: 'default' %}
{% assign nav_height = sections.header.settings.mobile_nav_height | default: 'normal' %}
{% assign show_labels = sections.header.settings.mobile_nav_show_labels | default: true %}

{% if nav_enabled %}
<nav class="mobile-nav mobile-nav--{{ nav_style }} mobile-nav--{{ nav_height }}" 
     role="navigation" 
     aria-label="{{ 'general.navigation.mobile_menu' | t }}">
  <ul class="mobile-nav__list">
    <!-- Home -->
    <li class="mobile-nav__item">
      <a href="{{ routes.root_url }}" 
         class="mobile-nav__link" 
         data-action="home"
         aria-label="{{ 'general.navigation.home' | t }}">
        <div class="mobile-nav__icon">
          {% render 'icon-home' %}
        </div>
        {% if show_labels %}
          <span class="mobile-nav__text">{{ 'general.navigation.home' | t | default: 'Home' }}</span>
        {% endif %}
      </a>
    </li>

    <!-- Search -->
    <li class="mobile-nav__item">
      <button type="button" 
              class="mobile-nav__link" 
              data-action="search"
              onclick="
                const searchModal = document.querySelector('.header__search details');
                if (searchModal) {
                  searchModal.open = true;
                  const searchInput = searchModal.querySelector('input[type=search], .search__input');
                  if (searchInput) {
                    setTimeout(() => searchInput.focus(), 100);
                  }
                } else {
                  const searchBar = document.querySelector('.header__search-bar input');
                  if (searchBar) searchBar.focus();
                }
              "
              aria-label="{{ 'general.search.search' | t }}">
        <div class="mobile-nav__icon">
          {% render 'icon-search' %}
        </div>
        {% if show_labels %}
          <span class="mobile-nav__text">{{ 'general.search.search' | t | default: 'Search' }}</span>
        {% endif %}
      </button>
    </li>

    <!-- Cart -->
    <li class="mobile-nav__item">
      <a href="{{ routes.cart_url }}" 
         class="mobile-nav__link" 
         data-action="cart"
         aria-label="{{ 'sections.cart.title' | t }} ({{ cart.item_count }} {{ 'sections.cart.headings.product' | t }})">
        <div class="mobile-nav__icon">
          {% if cart.item_count == 0 %}
            {% render 'icon-cart-empty' %}
          {% else %}
            {% render 'icon-cart' %}
          {% endif %}
        </div>
        {% if cart.item_count > 0 %}
          <span class="mobile-nav__badge" aria-hidden="true">{{ cart.item_count }}</span>
        {% else %}
          <span class="mobile-nav__badge" aria-hidden="true"></span>
        {% endif %}
        {% if show_labels %}
          <span class="mobile-nav__text">{{ 'sections.cart.title' | t | default: 'Cart' }}</span>
        {% endif %}
      </a>
    </li>

    <!-- Account -->
    <li class="mobile-nav__item">
      <a href="{{ routes.account_url }}" 
         class="mobile-nav__link" 
         data-action="account"
         aria-label="{% if customer %}{{ 'customer.account.title' | t }}{% else %}{{ 'customer.log_in' | t }}{% endif %}">
        <div class="mobile-nav__icon">
          {% render 'icon-account' %}
        </div>
        {% if show_labels %}
          <span class="mobile-nav__text">
            {% if customer %}
              {{ 'customer.account.title' | t | default: 'Account' }}
            {% else %}
              {{ 'customer.log_in' | t | default: 'Login' }}
            {% endif %}
          </span>
        {% endif %}
      </a>
    </li>
  </ul>
</nav>
{% endif %}

<!-- Mobile Search Overlay -->
<div class="mobile-search-overlay" role="dialog" aria-modal="true" aria-label="{{ 'general.search.search' | t }}">
  <button class="mobile-search-overlay__close" 
          type="button" 
          aria-label="{{ 'general.common.close' | t | default: 'Close' }}">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <line x1="18" y1="6" x2="6" y2="18"/>
      <line x1="6" y1="6" x2="18" y2="18"/>
    </svg>
  </button>
  
  <div class="mobile-search-overlay__content">
    <form action="{{ routes.search_url }}" method="get" role="search">
      <input type="search" 
             name="q" 
             class="mobile-search-overlay__input"
             placeholder="{{ 'general.search.placeholder' | t | default: 'Search products...' }}"
             aria-label="{{ 'general.search.search' | t }}"
             autocomplete="off"
             autocorrect="off"
             autocapitalize="off"
             spellcheck="false">
      <input type="hidden" name="type" value="product">
    </form>
  </div>
</div>

{% comment %}
  Add structured data for mobile navigation
{% endcomment %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "SiteNavigationElement",
  "name": "Mobile Navigation",
  "description": "Bottom navigation for mobile devices",
  "hasPart": [
    {
      "@type": "SiteNavigationElement",
      "name": "Home",
      "url": "{{ routes.root_url | prepend: request.origin }}"
    },
    {
      "@type": "SiteNavigationElement", 
      "name": "Search",
      "url": "{{ routes.search_url | prepend: request.origin }}"
    },
    {
      "@type": "SiteNavigationElement",
      "name": "Cart", 
      "url": "{{ routes.cart_url | prepend: request.origin }}"
    },
    {
      "@type": "SiteNavigationElement",
      "name": "Account",
      "url": "{{ routes.account_url | prepend: request.origin }}"
    }
  ]
}
</script>
