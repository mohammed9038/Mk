{% comment %}
  Mobile Bottom Navigation
  Renders a fixed bottom navigation for mobile devices with Home, Cart, Search, and Account links
  
  Settings controlled from Theme Customizer → Header → Mobile Navigation Settings
{% endcomment %}

{% comment %} Get settings from theme customizer {% endcomment %}
{% assign nav_enabled = sections.header.settings.enable_mobile_navigation | default: true %}
{% assign nav_style = sections.header.settings.mobile_nav_style | default: 'default' %}
{% assign nav_height = sections.header.settings.mobile_nav_height | default: 'normal' %}
{% assign show_labels = sections.header.settings.mobile_nav_show_labels | default: true %}
{% assign show_home = sections.header.settings.mobile_nav_show_home | default: true %}
{% assign show_search = sections.header.settings.mobile_nav_show_search | default: true %}
{% assign show_cart = sections.header.settings.mobile_nav_show_cart | default: true %}
{% assign show_account = sections.header.settings.mobile_nav_show_account | default: true %}

{% comment %} Count active navigation items for proper grid layout {% endcomment %}
{% assign nav_item_count = 0 %}
{% if show_home %}{% assign nav_item_count = nav_item_count | plus: 1 %}{% endif %}
{% if show_search %}{% assign nav_item_count = nav_item_count | plus: 1 %}{% endif %}
{% if show_cart %}{% assign nav_item_count = nav_item_count | plus: 1 %}{% endif %}
{% if show_account %}{% assign nav_item_count = nav_item_count | plus: 1 %}{% endif %}

{% if nav_enabled and nav_item_count > 0 %}
<nav class="mobile-nav mobile-nav--{{ nav_style }} mobile-nav--{{ nav_height }}" 
     role="navigation" 
     aria-label="{{ 'general.navigation.mobile_menu' | t }}"
     style="--nav-item-count: {{ nav_item_count }};">
  <ul class="mobile-nav__list">
    {% if show_home %}
    <!-- Home -->
    <li class="mobile-nav__item">
      <a href="{{ routes.root_url }}" 
         class="mobile-nav__link" 
         data-action="home"
         aria-label="{{ 'general.navigation.home' | t }}">
        <div class="mobile-nav__icon">
          {% render 'icon-home' %}
        </div>
        {% if show_labels %}
          <span class="mobile-nav__text">{{ 'general.navigation.home' | t | default: 'Home' }}</span>
        {% endif %}
      </a>
    </li>
    {% endif %}

    {% if show_search %}
    <!-- Search -->
    <li class="mobile-nav__item">
      <button type="button" 
              class="mobile-nav__link" 
              data-action="search"
              onclick="
                const searchModal = document.querySelector('.header__search details');
                if (searchModal) {
                  searchModal.open = true;
                  const searchInput = searchModal.querySelector('input[type=search], .search__input');
                  if (searchInput) {
                    setTimeout(() => searchInput.focus(), 100);
                  }
                } else {
                  const searchBar = document.querySelector('.header__search-bar input');
                  if (searchBar) searchBar.focus();
                }
              "
              aria-label="{{ 'general.search.search' | t }}">
        <div class="mobile-nav__icon">
          {% render 'icon-search' %}
        </div>
        {% if show_labels %}
          <span class="mobile-nav__text">{{ 'general.search.search' | t | default: 'Search' }}</span>
        {% endif %}
      </button>
    </li>
    {% endif %}

    {% if show_cart %}
    <!-- Cart -->
    <li class="mobile-nav__item">
      <a href="{{ routes.cart_url }}" 
         class="mobile-nav__link" 
         data-action="cart"
         aria-label="{{ 'sections.cart.title' | t }} ({{ cart.item_count }} {{ 'sections.cart.headings.product' | t }})">
        <div class="mobile-nav__icon">
          {% if cart.item_count == 0 %}
            {% render 'icon-cart-empty' %}
          {% else %}
            {% render 'icon-cart' %}
          {% endif %}
        </div>
        {% if cart.item_count > 0 %}
          <span class="mobile-nav__badge" aria-hidden="true">{{ cart.item_count }}</span>
        {% else %}
          <span class="mobile-nav__badge" aria-hidden="true"></span>
        {% endif %}
        {% if show_labels %}
          <span class="mobile-nav__text">{{ 'sections.cart.title' | t | default: 'Cart' }}</span>
        {% endif %}
      </a>
    </li>
    {% endif %}

    {% if show_account %}
    <!-- Account -->
    <li class="mobile-nav__item">
      <a href="{{ routes.account_url }}" 
         class="mobile-nav__link" 
         data-action="account"
         aria-label="{% if customer %}{{ 'customer.account.title' | t }}{% else %}{{ 'customer.log_in' | t }}{% endif %}">
        <div class="mobile-nav__icon">
          {% render 'icon-account' %}
        </div>
        {% if show_labels %}
          <span class="mobile-nav__text">
            {% if customer %}
              {{ 'customer.account.title' | t | default: 'Account' }}
            {% else %}
              {{ 'customer.log_in' | t | default: 'Login' }}
            {% endif %}
          </span>
        {% endif %}
      </a>
    </li>
    {% endif %}
  </ul>
</nav>
{% endif %}
