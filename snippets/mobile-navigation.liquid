{%- comment -%}
  Renders the mobile navigation bar with configurable items.

  Accepts:
  - nav_style: (string) 'bar' or 'floating'
  - nav_height: (string) 'short', 'medium', 'tall'
  - show_home: (boolean)
  - show_search: (boolean)
  - show_cart: (boolean)
  - show_account: (boolean)
  - show_labels: (boolean)

  Usage:
  {% render 'mobile-navigation',
     nav_style: section.settings.mobile_nav_style,
     ...
  %}
{%- endcomment -%}

{%- liquid
  assign nav_item_count = 0
  if show_home
    assign nav_item_count = nav_item_count | plus: 1
  endif
  if show_search
    assign nav_item_count = nav_item_count | plus: 1
  endif
  if show_cart
    assign nav_item_count = nav_item_count | plus: 1
  endif
  if show_account
    assign nav_item_count = nav_item_count | plus: 1
  endif
-%}

<nav class="mobile-nav mobile-nav--{{ nav_style }} mobile-nav--{{ nav_height }}"
     role="navigation"
     aria-label="{{ 'general.navigation.mobile_menu' | t }}"
     style="--nav-item-count: {{ nav_item_count }};">
  <ul class="mobile-nav__list">
    {% if show_home %}
    <li class="mobile-nav__item" data-action="home">
      <a href="{{ routes.root_url }}"
         class="mobile-nav__link{% if request.page_type == 'index' %} mobile-nav__link--active{% endif %}"
         aria-label="{{ 'general.navigation.home' | t }}">
        <div class="mobile-nav__icon">
          {% render 'icon-home' %}
        </div>
        {% if show_labels %}
          <span class="mobile-nav__text">{{ 'general.navigation.home' | t | default: 'Home' }}</span>
        {% endif %}
      </a>
    </li>
    {% endif %}

    {% if show_search %}
    <li class="mobile-nav__item" data-action="search">
      <button type="button"
              class="mobile-nav__link"
              aria-controls="Details-Header-Search"
              aria-expanded="false"
              onclick="
                const searchModalToggle = document.querySelector('details-modal.header__search summary');
                if (searchModalToggle) {
                  searchModalToggle.click();
                  setTimeout(() => {
                    const searchInput = document.querySelector('#Details-Header-Search input[type=\'search\']');
                    if (searchInput) searchInput.focus();
                  }, 100);
                }
              "
              aria-label="{{ 'general.search.search' | t }}">
        <div class="mobile-nav__icon">
          {% render 'icon-search' %}
        </div>
        {% if show_labels %}
          <span class="mobile-nav__text">{{ 'general.search.search' | t | default: 'Search' }}</span>
        {% endif %}
      </button>
    </li>
    {% endif %}

    {% if show_cart %}
    <li class="mobile-nav__item" data-action="cart">
      <a href="{{ routes.cart_url }}"
         class="mobile-nav__link{% if request.page_type == 'cart' %} mobile-nav__link--active{% endif %}"
         aria-label="{{ 'sections.cart.title' | t }} ({{ cart.item_count }} {{ 'sections.cart.headings.product' | t }})">
        <div class="mobile-nav__icon">
          {% if cart.item_count == 0 %}
            {% render 'icon-cart-empty' %}
          {% else %}
            {% render 'icon-cart' %}
          {% endif %}
        </div>
        {% if cart.item_count > 0 %}
          <span class="mobile-nav__badge" aria-hidden="true">{{ cart.item_count }}</span>
        {% endif %}
        {% if show_labels %}
          <span class="mobile-nav__text">{{ 'sections.cart.title' | t | default: 'Cart' }}</span>
        {% endif %}
      </a>
    </li>
    {% endif %}

    {% if show_account %}
    <li class="mobile-nav__item" data-action="account">
      <a href="{%- if customer -%}{{ routes.account_url }}{%- else -%}{{ routes.account_login_url }}{%- endif -%}"
         class="mobile-nav__link{% if request.page_type contains 'customers' %} mobile-nav__link--active{% endif %}"
         aria-label="{% if customer %}{{ 'customer.account.title' | t }}{% else %}{{ 'customer.log_in' | t }}{% endif %}">
        <div class="mobile-nav__icon">
          {% render 'icon-account' %}
        </div>
        {% if show_labels %}
          <span class="mobile-nav__text">
            {% if customer %}
              {{ 'customer.account.title' | t | default: 'Account' }}
            {% else %}
              {{ 'customer.log_in' | t | default: 'Login' }}
            {% endif %}
          </span>
        {% endif %}
      </a>
    </li>
    {% endif %}
  </ul>
</nav>

<script>
// This script is now much simpler and only adds an initialization class.
// All show/hide logic is handled by CSS media queries.
(function() {
  'use strict';

  function initMobileNav() {
    const mobileNav = document.querySelector('.mobile-nav');
    if (mobileNav) {
      mobileNav.classList.add('mobile-nav--initialized');
    }
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initMobileNav);
  } else {
    initMobileNav();
  }
})();
</script>
