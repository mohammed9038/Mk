{% comment %}
  Renders a header drawer menu for mobile and desktop.

  Usage:
  {% render 'header-drawer' %}
{% endcomment %}

<header-drawer data-breakpoint="{% if section.settings.menu_type_desktop == 'drawer' %}desktop{% else %}tablet{% endif %}">
  <details id="Details-menu-drawer-container" class="menu-drawer-container">
    <summary
      class="header__icon header__icon--menu header__icon--summary link focus-inset"
      aria-label="{{ 'sections.header.menu' | t }}"
    >
      <span>
        {% render 'icon-hamburger' %}
        {% render 'icon-close' %}
      </span>
    </summary>
    <div id="menu-drawer" class="menu-drawer professional-drawer gradient motion-reduce color-{{ section.settings.menu_color_scheme }}">
      <div class="drawer-header">
        <div class="drawer-header__content">
          <h2 class="drawer-header__title">Menu</h2>
          <button class="drawer-header__close" onclick="document.getElementById('Details-menu-drawer-container').removeAttribute('open')" aria-label="{{ 'accessibility.close' | t }}">
            {% render 'icon-close' %}
          </button>
        </div>
      </div>
      
      <div class="professional-drawer__content">
        <!-- Top Utility Section (Language & Login) -->
        <div class="drawer-section drawer-section--top-utilities">
          <div class="utility-group utility-group--top">
            <!-- Language Selector -->
            {%- if localization.available_languages.size > 1 -%}
              <div class="utility-item utility-item--language">
                <localization-form>
                  {%- form 'localization', id: 'DrawerLocalizationForm', accept-charset: 'UTF-8', class: 'localization-form', enctype: 'multipart/form-data' -%}
                    <div class="localization-form__select">
                      <label for="DrawerLanguageSelector" class="visually-hidden">
                        {{ 'localization.language_label' | t }}
                      </label>
                      <select
                        id="DrawerLanguageSelector"
                        class="localization-selector"
                        name="locale_code"
                        onchange="this.form.submit()"
                      >
                        {%- for language in localization.available_languages -%}
                          <option
                            value="{{ language.iso_code }}"
                            lang="{{ language.iso_code }}"
                            {%- if language.iso_code == localization.language.iso_code %} selected{% endif %}
                          >
                            {{ language.endonym_name | capitalize }}
                          </option>
                        {%- endfor -%}
                      </select>
                      {% render 'icon-caret' %}
                    </div>
                  {%- endform -%}
                </localization-form>
              </div>
            {%- endif -%}
            
            <!-- Account Link -->
            {%- if shop.customer_accounts_enabled -%}
              <a
                href="{%- if customer -%}{{ routes.account_url }}{%- else -%}{{ routes.account_login_url }}{%- endif -%}"
                class="utility-item utility-item--account"
              >
                <span class="utility-item__icon">
                  {% render 'icon-account' %}
                </span>
                <span class="utility-item__text">
                  {%- liquid
                    if customer
                      echo 'customer.account_fallback' | t
                    else
                      echo 'customer.log_in' | t
                    endif
                  -%}
                </span>
                <span class="utility-item__arrow">
                  {% render 'icon-arrow' %}
                </span>
              </a>
            {%- endif -%}
          </div>
        </div>
        
        <!-- Separator Line -->
        <div class="drawer-separator"></div>
        
        <!-- Navigation Section -->
        <div class="drawer-section drawer-section--navigation">
          <nav class="professional-navigation" role="navigation" aria-label="Primary navigation">
            <ul class="professional-menu" role="list">
              {%- for link in section.settings.menu.links -%}
                <li>
                  {%- if link.links != blank -%}
                    <details id="DrawerMenu-{{ link.handle }}" class="professional-submenu">
                      <summary class="professional-menu__link">
                        <span class="professional-menu__text">{{ link.title | escape }}</span>
                        <span class="professional-menu__icon">
                          {% render 'icon-caret' %}
                        </span>
                      </summary>
                      <div class="professional-submenu__content">
                        <ul class="professional-submenu__list" role="list">
                          {%- for childlink in link.links -%}
                            <li class="professional-submenu__item">
                              {%- if childlink.links == blank -%}
                                <a
                                  href="{{ childlink.url }}"
                                  class="professional-submenu__link{% if childlink.current %} active{% endif %}"
                                  {% if childlink.current %}aria-current="page"{% endif %}
                                >
                                  {{ childlink.title | escape }}
                                </a>
                              {%- else -%}
                                <details id="DrawerSubmenu-{{ link.handle }}-{{ childlink.handle }}" class="professional-nested-submenu">
                                  <summary class="professional-submenu__link">
                                    <span>{{ childlink.title | escape }}</span>
                                    <span class="professional-menu__icon">
                                      {% render 'icon-caret' %}
                                    </span>
                                  </summary>
                                  <ul class="professional-nested-list" role="list">
                                    {%- for grandchildlink in childlink.links -%}
                                      <li>
                                        <a
                                          href="{{ grandchildlink.url }}"
                                          class="professional-nested-link{% if grandchildlink.current %} active{% endif %}"
                                          {% if grandchildlink.current %}aria-current="page"{% endif %}
                                        >
                                          {{ grandchildlink.title | escape }}
                                        </a>
                                      </li>
                                    {%- endfor -%}
                                  </ul>
                                </details>
                              {%- endif -%}
                            </li>
                          {%- endfor -%}
                        </ul>
                      </div>
                    </details>
                  {%- else -%}
                    <a
                      href="{{ link.url }}"
                      class="professional-menu__link{% if link.current %} active{% endif %}"
                      {% if link.current %}aria-current="page"{% endif %}
                    >
                      <span class="professional-menu__text">{{ link.title | escape }}</span>
                    </a>
                  {%- endif -%}
                </li>
              {%- endfor -%}
            </ul>
          </nav>
        </div>
        
        <!-- Bottom Utilities Section -->
        <div class="drawer-section drawer-section--utilities">
          {%- liquid
            assign has_social = false
            if settings.social_twitter_link != blank or settings.social_facebook_link != blank or settings.social_pinterest_link != blank or settings.social_instagram_link != blank or settings.social_tiktok_link != blank or settings.social_tumblr_link != blank or settings.social_snapchat_link != blank or settings.social_youtube_link != blank or settings.social_vimeo_link != blank
              assign has_social = true
            endif
          -%}
          
          {%- if has_social -%}
            <div class="utility-group">
              <h3 class="utility-group__title">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
                </svg>
                {{ 'general.social.heading' | t | default: 'Follow Us' }}
              </h3>
              <div class="professional-social-grid">
                {%- if settings.social_facebook_link != blank -%}
                  <a href="{{ settings.social_facebook_link }}" class="professional-social-link" aria-label="{{ 'general.social.links.facebook' | t }}">
                    {%- render 'icon-facebook' -%}
                  </a>
                {%- endif -%}
                {%- if settings.social_instagram_link != blank -%}
                  <a href="{{ settings.social_instagram_link }}" class="professional-social-link" aria-label="{{ 'general.social.links.instagram' | t }}">
                    {%- render 'icon-instagram' -%}
                  </a>
                {%- endif -%}
                {%- if settings.social_twitter_link != blank -%}
                  <a href="{{ settings.social_twitter_link }}" class="professional-social-link" aria-label="{{ 'general.social.links.twitter' | t }}">
                    {%- render 'icon-twitter' -%}
                  </a>
                {%- endif -%}
                {%- if settings.social_youtube_link != blank -%}
                  <a href="{{ settings.social_youtube_link }}" class="professional-social-link" aria-label="{{ 'general.social.links.youtube' | t }}">
                    {%- render 'icon-youtube' -%}
                  </a>
                {%- endif -%}
                {%- if settings.social_tiktok_link != blank -%}
                  <a href="{{ settings.social_tiktok_link }}" class="professional-social-link" aria-label="{{ 'general.social.links.tiktok' | t }}">
                    {%- render 'icon-tiktok' -%}
                  </a>
                {%- endif -%}
                {%- if settings.social_pinterest_link != blank -%}
                  <a href="{{ settings.social_pinterest_link }}" class="professional-social-link" aria-label="{{ 'general.social.links.pinterest' | t }}">
                    {%- render 'icon-pinterest' -%}
                  </a>
                {%- endif -%}
              </div>
            </div>
          {%- endif -%}
        </div>
      </div>
    </div>
  </details>
</header-drawer>
