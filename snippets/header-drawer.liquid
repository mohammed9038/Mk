{% comment %}
  Professional Mobile Drawer Menu
  Enhanced mobile navigation with proper settings and clean design
{% endcomment %}

<header-drawer data-breakpoint="{% if section.settings.menu_type_desktop == 'drawer' %}desktop{% else %}tablet{% endif %}">
  <details id="Details-menu-drawer-container" class="menu-drawer-container">
    <summary
      class="header__icon header__icon--menu header__icon--summary link focus-inset"
      aria-label="{{ 'sections.header.menu' | t }}"
    >
      <span>
        {% render 'icon-hamburger' %}
        {% render 'icon-close' %}
      </span>
    </summary>

    <div id="menu-drawer" class="professional-mobile-drawer gradient motion-reduce color-{{ section.settings.menu_color_scheme | default: 'background-1' }}">
      <!-- Drawer Header -->
      <div class="pro-drawer__header">
        <div class="pro-drawer__header-content">
          <h2 class="pro-drawer__title">{{ section.settings.drawer_title | default: 'Menu' }}</h2>
          <button
            class="pro-drawer__close"
            onclick="document.getElementById('Details-menu-drawer-container').removeAttribute('open')"
            aria-label="{{ 'accessibility.close' | t }}"
          >
            {% render 'icon-close' %}
          </button>
        </div>
      </div>

      <div class="pro-drawer__content">
        
        <!-- Top Utilities Section -->
        {%- if section.settings.show_drawer_utilities -%}
        <div class="pro-drawer__utilities">
          
          <!-- GTranslate Language Selector -->
          {%- if section.settings.show_language_selector -%}
          <div class="pro-utility">
            <div class="pro-utility__icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <circle cx="12" cy="12" r="10"/>
                <line x1="2" y1="12" x2="22" y2="12"/>
                <path d="m4.93 4.93 4.24 4.24"/>
                <path d="m14.83 9.17 4.24-4.24"/>
                <path d="m14.83 14.83 4.24 4.24"/>
                <path d="m9.17 14.83-4.24 4.24"/>
              </svg>
            </div>
            <div class="pro-utility__content">
              <div class="pro-gtranslate-wrapper">
                <!-- Disabled: Using single header instance only -->
                <!-- <div class="gtranslate_wrapper gtranslate-drawer"></div> -->
              </div>
            </div>
          </div>
          {%- endif -%}

          <!-- Account Link -->
          {%- if section.settings.show_account_link and shop.customer_accounts_enabled -%}
          <a
            href="{%- if customer -%}{{ routes.account_url }}{%- else -%}{{ routes.account_login_url }}{%- endif -%}"
            class="pro-utility pro-utility--link"
          >
            <div class="pro-utility__icon">
              {% render 'icon-account' %}
            </div>
            <div class="pro-utility__content">
              <span class="pro-utility__text">
                {%- if customer -%}
                  {{ 'customer.account_fallback' | t }}
                {%- else -%}
                  {{ 'customer.log_in' | t }}
                {%- endif -%}
              </span>
            </div>
            <div class="pro-utility__arrow">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9,18 15,12 9,6"></polyline>
              </svg>
            </div>
          </a>
          {%- endif -%}

        </div>

        <!-- Utilities Separator -->
        <div class="pro-drawer__separator"></div>
        {%- endif -%}

        <!-- Navigation Menu -->
        <nav class="pro-drawer__navigation" role="navigation" aria-label="Main navigation">
          <ul class="pro-nav-list" role="list">
            {%- for link in section.settings.menu.links -%}
              <li class="pro-nav-item">
                {%- if link.links != blank -%}
                  <details class="pro-nav-submenu" {% if section.settings.drawer_auto_expand %}open{% endif %}>
                    <summary class="pro-nav-link pro-nav-link--parent">
                      <span class="pro-nav-text">{{ link.title | escape }}</span>
                      <span class="pro-nav-icon">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <polyline points="6,9 12,15 18,9"></polyline>
                        </svg>
                      </span>
                    </summary>
                    <div class="pro-submenu-content">
                      <ul class="pro-submenu-list" role="list">
                        {%- for childlink in link.links -%}
                          <li class="pro-submenu-item">
                            {%- if childlink.links == blank -%}
                              <a
                                href="{{ childlink.url }}"
                                class="pro-submenu-link{% if childlink.current %} pro-nav-active{% endif %}"
                                {% if childlink.current %}aria-current="page"{% endif %}
                              >
                                {{ childlink.title | escape }}
                              </a>
                            {%- else -%}
                              <details class="pro-nav-nested">
                                <summary class="pro-submenu-link pro-submenu-link--parent">
                                  <span>{{ childlink.title | escape }}</span>
                                  <span class="pro-nav-icon pro-nav-icon--small">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                      <polyline points="6,9 12,15 18,9"></polyline>
                                    </svg>
                                  </span>
                                </summary>
                                <ul class="pro-nested-list" role="list">
                                  {%- for grandchildlink in childlink.links -%}
                                    <li>
                                      <a
                                        href="{{ grandchildlink.url }}"
                                        class="pro-nested-link{% if grandchildlink.current %} pro-nav-active{% endif %}"
                                        {% if grandchildlink.current %}aria-current="page"{% endif %}
                                      >
                                        {{ grandchildlink.title | escape }}
                                      </a>
                                    </li>
                                  {%- endfor -%}
                                </ul>
                              </details>
                            {%- endif -%}
                          </li>
                        {%- endfor -%}
                      </ul>
                    </div>
                  </details>
                {%- else -%}
                  <a
                    href="{{ link.url }}"
                    class="pro-nav-link{% if link.current %} pro-nav-active{% endif %}"
                    {% if link.current %}aria-current="page"{% endif %}
                  >
                    <span class="pro-nav-text">{{ link.title | escape }}</span>
                  </a>
                {%- endif -%}
              </li>
            {%- endfor -%}
          </ul>
        </nav>

        <!-- Bottom Section -->
        {%- if section.settings.show_drawer_social -%}
        <div class="pro-drawer__bottom">
          <div class="pro-drawer__separator"></div>
          
          <!-- Social Links -->
          {%- liquid
            assign social_accounts = 'facebook,instagram,twitter,pinterest,youtube,tiktok,linkedin,snapchat,tumblr,vimeo' | split: ','
            assign has_social = false
            for social in social_accounts
              assign social_url = 'social_' | append: social | append: '_link'
              if settings[social_url] != blank
                assign has_social = true
                break
              endif
            endfor
          -%}
          
          {%- if has_social -%}
          <div class="pro-social-section">
            <h3 class="pro-social-title">{{ section.settings.social_heading | default: 'Follow Us' }}</h3>
            <div class="pro-social-grid">
              {%- for social in social_accounts -%}
                {%- assign social_url = 'social_' | append: social | append: '_link' -%}
                {%- if settings[social_url] != blank -%}
                  <a
                    href="{{ settings[social_url] }}"
                    class="pro-social-link"
                    aria-label="{{ social | capitalize }}"
                    target="_blank"
                    rel="noopener"
                  >
                    {%- render 'icon-social', social: social -%}
                  </a>
                {%- endif -%}
              {%- endfor -%}
            </div>
          </div>
          {%- endif -%}
        </div>
        {%- endif -%}

      </div>
    </div>
  </details>
</header-drawer>

<!-- Initialize GTranslate in Drawer -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  let drawerObserver;
  let gtranslateInitialized = false;
  
  // Function to initialize GTranslate in drawer
  function initGTranslateInDrawer() {
    if (gtranslateInitialized) return;
    
    const drawerGTranslate = document.querySelector('.gtranslate-drawer');
    if (drawerGTranslate && window.gtranslateSettings) {
      try {
        // Create GTranslate widget for drawer
        const gtWidget = new window.GTranslateWidget({
          ...window.gtranslateSettings,
          wrapper_selector: '.gtranslate-drawer',
          flag_style: 'text',
          dropdown_open_position: 'below'
        });
        gtranslateInitialized = true;
      } catch (e) {
        console.log('GTranslate drawer init will retry...');
        // Retry after a short delay
        setTimeout(initGTranslateInDrawer, 500);
      }
    }
  }
  
  // Initialize when drawer opens
  const drawerContainer = document.getElementById('Details-menu-drawer-container');
  if (drawerContainer) {
    // Watch for drawer state changes
    drawerObserver = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'open') {
          if (drawerContainer.hasAttribute('open')) {
            // Drawer opened - initialize GTranslate
            setTimeout(initGTranslateInDrawer, 100);
          }
        }
      });
    });
    
    drawerObserver.observe(drawerContainer, {
      attributes: true,
      attributeFilter: ['open']
    });
    
    // Also try to initialize if drawer is already open
    if (drawerContainer.hasAttribute('open')) {
      setTimeout(initGTranslateInDrawer, 100);
    }
  }
  
  // Cleanup on page unload
  window.addEventListener('beforeunload', function() {
    if (drawerObserver) {
      drawerObserver.disconnect();
    }
  });
});
</script>

<!-- Professional Drawer Styles -->
<style>
  /* Professional Mobile Drawer - Clean Reset */
  .professional-mobile-drawer {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: {{ section.settings.drawer_width | default: 320 }}px !important;
    max-width: 90vw !important;
    height: 100vh !important;
    background: rgb(var(--color-background)) !important;
    border-right: 1px solid rgba(var(--color-border), 0.1) !important;
    box-shadow: 0 0 20px rgba(0,0,0,0.1) !important;
    z-index: 999 !important;
    transform: translateX(-100%) !important;
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    overflow: hidden !important;
    display: flex !important;
    flex-direction: column !important;
  }

  .menu-drawer-container[open] .professional-mobile-drawer {
    transform: translateX(0) !important;
  }

  /* Header */
  .pro-drawer__header {
    flex-shrink: 0;
    background: {{ section.settings.drawer_header_bg | default: 'rgb(var(--color-background))' }};
    border-bottom: 1px solid rgba(var(--color-border), 0.1);
    position: relative;
  }

  .pro-drawer__header-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1.5rem 2rem;
    min-height: 6rem;
  }

  .pro-drawer__title {
    margin: 0;
    font-size: {{ section.settings.drawer_title_size | default: 18 }}px;
    font-weight: 600;
    color: {{ section.settings.drawer_title_color | default: 'rgb(var(--color-foreground))' }};
    letter-spacing: -0.02em;
  }

  .pro-drawer__close {
    background: none;
    border: none;
    padding: 0.5rem;
    cursor: pointer;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    color: rgb(var(--color-foreground));
    width: 4rem;
    height: 4rem;
  }

  .pro-drawer__close:hover {
    background: rgba(var(--color-foreground), 0.08);
    transform: scale(1.05);
  }

  .pro-drawer__close svg {
    width: 2rem;
    height: 2rem;
  }

  /* Content */
  .pro-drawer__content {
    flex: 1;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    padding: 0;
  }

  /* Utilities Section */
  .pro-drawer__utilities {
    padding: 2rem;
    background: {{ section.settings.utilities_bg | default: 'rgba(var(--color-foreground), 0.02)' }};
  }

  .pro-utility {
    display: flex;
    align-items: center;
    padding: 1.2rem 0;
    border-bottom: 1px solid rgba(var(--color-border), 0.05);
    transition: all 0.2s ease;
  }

  .pro-utility:last-child {
    border-bottom: none;
  }

  .pro-utility--link {
    text-decoration: none;
    color: rgb(var(--color-foreground));
    cursor: pointer;
  }

  .pro-utility--link:hover {
    background: rgba(var(--color-foreground), 0.03);
    margin: 0 -2rem;
    padding-left: 2rem;
    padding-right: 2rem;
    border-radius: 0.8rem;
  }

  .pro-utility__icon {
    flex-shrink: 0;
    width: 2.4rem;
    height: 2.4rem;
    display: flex;
    align-items: center;
    justify-content: center;
    color: rgba(var(--color-foreground), 0.7);
    margin-right: 1.2rem;
  }

  .pro-utility__content {
    flex: 1;
    position: relative;
  }

  .pro-utility__text {
    font-size: 1.5rem;
    font-weight: 500;
    color: rgb(var(--color-foreground));
  }

  .pro-utility__arrow {
    flex-shrink: 0;
    color: rgba(var(--color-foreground), 0.5);
    margin-left: 1rem;
  }

  /* Language/Country Forms */
  .pro-language-form,
  .pro-country-form {
    position: relative;
    width: 100%;
  }

  .pro-language-select,
  .pro-country-select {
    width: 100%;
    background: none;
    border: none;
    font-size: 1.5rem;
    font-weight: 500;
    color: rgb(var(--color-foreground));
    cursor: pointer;
    appearance: none;
    padding-right: 2rem;
  }

  .pro-language-arrow,
  .pro-country-arrow {
    position: absolute;
    right: 0;
    top: 50%;
    transform: translateY(-50%);
    pointer-events: none;
    color: rgba(var(--color-foreground), 0.5);
  }

  /* Separator */
  .pro-drawer__separator {
    height: 1px;
    background: rgba(var(--color-border), 0.1);
    margin: 0 2rem;
  }

  /* Navigation */
  .pro-drawer__navigation {
    padding: 2rem;
  }

  .pro-nav-list {
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .pro-nav-item {
    margin-bottom: 0.4rem;
  }

  .pro-nav-link {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1.5rem 0;
    font-size: {{ section.settings.nav_font_size | default: 16 }}px;
    font-weight: {{ section.settings.nav_font_weight | default: 500 }};
    color: {{ section.settings.nav_text_color | default: 'rgb(var(--color-foreground))' }};
    text-decoration: none;
    border-bottom: 1px solid rgba(var(--color-border), 0.05);
    transition: all 0.2s ease;
    cursor: pointer;
  }

  .pro-nav-link:hover {
    color: {{ section.settings.nav_hover_color | default: 'rgb(var(--color-base-accent-1))' }};
    background: rgba(var(--color-foreground), 0.02);
    margin: 0 -2rem;
    padding-left: 2rem;
    padding-right: 2rem;
    border-radius: 0.8rem;
  }

  .pro-nav-active {
    color: {{ section.settings.nav_active_color | default: 'rgb(var(--color-base-accent-1))' }} !important;
    font-weight: 600;
  }

  .pro-nav-text {
    flex: 1;
  }

  .pro-nav-icon {
    transition: transform 0.2s ease;
    color: rgba(var(--color-foreground), 0.6);
  }

  .pro-nav-submenu[open] .pro-nav-icon {
    transform: rotate(180deg);
  }

  /* Submenu */
  .pro-submenu-content {
    background: rgba(var(--color-foreground), 0.02);
    border-radius: 0.8rem;
    margin: 1rem 0;
    overflow: hidden;
  }

  .pro-submenu-list {
    list-style: none;
    margin: 0;
    padding: 1rem;
  }

  .pro-submenu-item {
    margin-bottom: 0.2rem;
  }

  .pro-submenu-link {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem;
    font-size: 1.4rem;
    color: rgba(var(--color-foreground), 0.8);
    text-decoration: none;
    border-radius: 0.6rem;
    transition: all 0.2s ease;
  }

  .pro-submenu-link:hover {
    background: rgba(var(--color-foreground), 0.05);
    color: rgb(var(--color-foreground));
  }

  /* Nested Menu */
  .pro-nested-list {
    list-style: none;
    margin: 0.5rem 0 0 0;
    padding: 0;
    background: rgba(var(--color-foreground), 0.03);
    border-radius: 0.6rem;
  }

  .pro-nested-link {
    display: block;
    padding: 0.8rem 1.2rem;
    font-size: 1.3rem;
    color: rgba(var(--color-foreground), 0.7);
    text-decoration: none;
    transition: all 0.2s ease;
  }

  .pro-nested-link:hover {
    background: rgba(var(--color-foreground), 0.05);
    color: rgb(var(--color-foreground));
  }

  /* Bottom Section */
  .pro-drawer__bottom {
    padding: 2rem;
    background: rgba(var(--color-foreground), 0.02);
  }

  .pro-social-section {
    text-align: center;
  }

  .pro-social-title {
    margin: 0 0 1.5rem 0;
    font-size: 1.4rem;
    font-weight: 600;
    color: rgba(var(--color-foreground), 0.8);
  }

  .pro-social-grid {
    display: flex;
    justify-content: center;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .pro-social-link {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 4rem;
    height: 4rem;
    background: rgba(var(--color-foreground), 0.05);
    border-radius: 50%;
    color: rgba(var(--color-foreground), 0.7);
    text-decoration: none;
    transition: all 0.2s ease;
  }

  .pro-social-link:hover {
    background: rgba(var(--color-foreground), 0.1);
    color: rgb(var(--color-foreground));
    transform: translateY(-2px);
  }

  .pro-social-link svg {
    width: 2rem;
    height: 2rem;
  }

  /* Responsive */
  @media screen and (max-width: 480px) {
    .professional-mobile-drawer {
      width: 100vw !important;
      max-width: 100vw !important;
    }
  }
</style>
