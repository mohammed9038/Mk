{% comment %}
  Renders a header drawer menu for mobile and desktop.

  Usage:
  {% render 'header-drawer' %}
{% endcomment %}

<header-drawer data-breakpoint="{% if section.settings.menu_type_desktop == 'drawer' %}desktop{% else %}tablet{% endif %}">
  <details id="Details-menu-drawer-container" class="menu-drawer-container">
    <summary
      class="header__icon header__icon--menu header__icon--summary link focus-inset"
      aria-label="{{ 'sections.header.menu' | t }}"
    >
      <span>
        {% render 'icon-hamburger' %}
        {% render 'icon-close' %}
      </span>
    </summary>
    <div id="menu-drawer" class="professional-drawer gradient motion-reduce color-{{ section.settings.menu_color_scheme }}">
      <!-- Professional Drawer Header -->
      <div class="drawer-header">
        <div class="drawer-header__content">
          <h2 class="drawer-header__title">Menu</h2>
          <button class="drawer-header__close" onclick="document.getElementById('Details-menu-drawer-container').removeAttribute('open')">
            {% render 'icon-close' %}
          </button>
        </div>
      </div>

      <!-- Drawer Content Container with enhanced structure -->
      <div class="professional-drawer__content">
        
        <!-- Primary Navigation Section -->
        <div class="drawer-section drawer-section--navigation">
          <nav class="professional-navigation">
            <ul class="professional-menu" role="list">
              {%- for link in section.settings.menu.links -%}
                <li class="professional-menu__item">
                  {%- if link.links != blank -%}
                    <details class="professional-submenu" id="Details-professional-menu-{{ forloop.index }}">
                      <summary class="professional-menu__link professional-menu__parent{% if link.child_active %} active{% endif %}">
                        <span class="professional-menu__text">{{ link.title | escape }}</span>
                        <span class="professional-menu__icon">
                          {% render 'icon-caret' %}
                        </span>
                      </summary>
                      <div class="professional-submenu__content">
                        <div class="professional-submenu__header">
                          <button class="professional-submenu__back" onclick="this.closest('details').removeAttribute('open')">
                            {% render 'icon-arrow' %}
                            <span>Back to Menu</span>
                          </button>
                          <h3 class="professional-submenu__title">{{ link.title | escape }}</h3>
                        </div>
                        <ul class="professional-submenu__list" role="list">
                          {%- for childlink in link.links -%}
                            <li class="professional-submenu__item">
                              {%- if childlink.links == blank -%}
                                <a href="{{ childlink.url }}" class="professional-submenu__link{% if childlink.current %} active{% endif %}">
                                  {{ childlink.title | escape }}
                                </a>
                              {%- else -%}
                                <details class="professional-nested-submenu">
                                  <summary class="professional-submenu__link professional-submenu__parent">
                                    <span>{{ childlink.title | escape }}</span>
                                    <span class="professional-menu__icon">
                                      {% render 'icon-caret' %}
                                    </span>
                                  </summary>
                                  <ul class="professional-nested-list" role="list">
                                    {%- for grandchildlink in childlink.links -%}
                                      <li>
                                        <a href="{{ grandchildlink.url }}" class="professional-nested-link{% if grandchildlink.current %} active{% endif %}">
                                          {{ grandchildlink.title | escape }}
                                        </a>
                                      </li>
                                    {%- endfor -%}
                                  </ul>
                                </details>
                              {%- endif -%}
                            </li>
                          {%- endfor -%}
                        </ul>
                      </div>
                    </details>
                  {%- else -%}
                    <a href="{{ link.url }}" class="professional-menu__link{% if link.current %} active{% endif %}">
                      <span class="professional-menu__text">{{ link.title | escape }}</span>
                    </a>
                  {%- endif -%}
                </li>
              {%- endfor -%}
            </ul>
          </nav>
        </div>

        <!-- Utility Section with enhanced styling -->
        <div class="drawer-section drawer-section--utilities">
          
          <!-- Language Selector Section (Before Login) -->
          {%- if localization.available_languages and localization.available_languages.size > 1 -%}
            <div class="utility-group utility-group--language">
              <h3 class="utility-group__title">
                {% render 'icon-globe' %}
                {{ 'localization.language_label' | t }}
              </h3>
              <div class="professional-language-selector">
                <div class="gtranslate_wrapper professional-gtranslate"></div>
              </div>
            </div>
          {%- endif -%}

          <!-- Account Section -->
          {%- if shop.customer_accounts_enabled -%}
            <div class="utility-group utility-group--account">
              <a href="{%- if customer -%}{{ routes.account_url }}{%- else -%}{{ routes.account_login_url }}{%- endif -%}" 
                 class="utility-link utility-link--account">
                <span class="utility-link__icon">
                  {% render 'icon-account' %}
                </span>
                <span class="utility-link__text">
                  {%- if customer -%}
                    {{ 'customer.account_fallback' | t }}
                  {%- else -%}
                    {{ 'customer.log_in' | t }}
                  {%- endif -%}
                </span>
                <span class="utility-link__arrow">
                  {% render 'icon-arrow' %}
                </span>
              </a>
            </div>
          {%- endif -%}

          <!-- Social Media Section with enhanced design -->
          <div class="utility-group utility-group--social">
            <h3 class="utility-group__title">Follow Us</h3>
            <div class="professional-social-grid">
              {%- if settings.social_facebook_link != blank -%}
                <a href="{{ settings.social_facebook_link }}" class="professional-social-link" target="_blank" rel="noopener">
                  {%- render 'icon-facebook' -%}
                  <span class="visually-hidden">{{ 'general.social.links.facebook' | t }}</span>
                </a>
              {%- endif -%}
              {%- if settings.social_instagram_link != blank -%}
                <a href="{{ settings.social_instagram_link }}" class="professional-social-link" target="_blank" rel="noopener">
                  {%- render 'icon-instagram' -%}
                  <span class="visually-hidden">{{ 'general.social.links.instagram' | t }}</span>
                </a>
              {%- endif -%}
              {%- if settings.social_twitter_link != blank -%}
                <a href="{{ settings.social_twitter_link }}" class="professional-social-link" target="_blank" rel="noopener">
                  {%- render 'icon-twitter' -%}
                  <span class="visually-hidden">{{ 'general.social.links.twitter' | t }}</span>
                </a>
              {%- endif -%}
              {%- if settings.social_youtube_link != blank -%}
                <a href="{{ settings.social_youtube_link }}" class="professional-social-link" target="_blank" rel="noopener">
                  {%- render 'icon-youtube' -%}
                  <span class="visually-hidden">{{ 'general.social.links.youtube' | t }}</span>
                </a>
              {%- endif -%}
              {%- if settings.social_pinterest_link != blank -%}
                <a href="{{ settings.social_pinterest_link }}" class="professional-social-link" target="_blank" rel="noopener">
                  {%- render 'icon-pinterest' -%}
                  <span class="visually-hidden">{{ 'general.social.links.pinterest' | t }}</span>
                </a>
              {%- endif -%}
              {%- if settings.social_tiktok_link != blank -%}
                <a href="{{ settings.social_tiktok_link }}" class="professional-social-link" target="_blank" rel="noopener">
                  {%- render 'icon-tiktok' -%}
                  <span class="visually-hidden">{{ 'general.social.links.tiktok' | t }}</span>
                </a>
              {%- endif -%}
              {%- if settings.social_tumblr_link != blank -%}
                <a href="{{ settings.social_tumblr_link }}" class="professional-social-link" target="_blank" rel="noopener">
                  {%- render 'icon-tumblr' -%}
                  <span class="visually-hidden">{{ 'general.social.links.tumblr' | t }}</span>
                </a>
              {%- endif -%}
              {%- if settings.social_snapchat_link != blank -%}
                <a href="{{ settings.social_snapchat_link }}" class="professional-social-link" target="_blank" rel="noopener">
                  {%- render 'icon-snapchat' -%}
                  <span class="visually-hidden">{{ 'general.social.links.snapchat' | t }}</span>
                </a>
              {%- endif -%}
              {%- if settings.social_vimeo_link != blank -%}
                <a href="{{ settings.social_vimeo_link }}" class="professional-social-link" target="_blank" rel="noopener">
                  {%- render 'icon-vimeo' -%}
                  <span class="visually-hidden">{{ 'general.social.links.vimeo' | t }}</span>
                </a>
              {%- endif -%}
            </div>
          </div>
        </div>
      </div>
    </div>
  </details>
</header-drawer>
