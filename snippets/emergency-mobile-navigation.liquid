{% comment %}
  Emergency Mobile Navigation - Always Renders
  This is a fallback mobile navigation that always displays
{% endcomment %}

<nav id="emergency-mobile-nav" class="emergency-mobile-nav" style="
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 10002;
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  height: 88px;
  padding: 8px 0 calc(8px + env(safe-area-inset-bottom));
  box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
  display: none;
">
  <ul style="
    display: flex;
    justify-content: space-around;
    align-items: center;
    list-style: none;
    margin: 0;
    padding: 0 16px;
    height: 72px;
    width: 100%;
    box-sizing: border-box;
  ">
    <!-- Home -->
    <li style="display: flex; flex: 1; max-width: 80px; justify-content: center;">
      <a href="{{ routes.root_url }}" style="
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        color: #333;
        padding: 8px 4px;
        width: 100%;
        height: 64px;
      ">
        <div style="
          width: 32px;
          height: 32px;
          margin-bottom: 4px;
          display: flex;
          align-items: center;
          justify-content: center;
        ">
          <svg width="28" height="28" viewBox="0 0 18 19" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9,22 9,12 15,12 15,22"></polyline>
          </svg>
        </div>
        <span style="
          font-size: 11px;
          font-weight: 500;
          line-height: 1.2;
          text-align: center;
          white-space: nowrap;
        ">Home</span>
      </a>
    </li>

    <!-- Search -->
    <li style="display: flex; flex: 1; max-width: 80px; justify-content: center;">
      <button type="button" onclick="
        const searchModal = document.querySelector('.header__search details');
        if (searchModal) {
          searchModal.open = true;
          const searchInput = searchModal.querySelector('input[type=search], .search__input');
          if (searchInput) {
            setTimeout(() => searchInput.focus(), 100);
          }
        } else {
          const searchBar = document.querySelector('.header__search-bar input');
          if (searchBar) searchBar.focus();
        }
      " style="
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        color: #333;
        padding: 8px 4px;
        width: 100%;
        height: 64px;
        border: none;
        background: none;
        cursor: pointer;
        font-family: inherit;
      ">
        <div style="
          width: 32px;
          height: 32px;
          margin-bottom: 4px;
          display: flex;
          align-items: center;
          justify-content: center;
        ">
          <svg width="28" height="28" viewBox="0 0 18 19" fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
        </div>
        <span style="
          font-size: 11px;
          font-weight: 500;
          line-height: 1.2;
          text-align: center;
          white-space: nowrap;
        ">Search</span>
      </button>
    </li>

    <!-- Cart -->
    <li style="display: flex; flex: 1; max-width: 80px; justify-content: center; position: relative;">
      <a href="{{ routes.cart_url }}" style="
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        color: #333;
        padding: 8px 4px;
        width: 100%;
        height: 64px;
        position: relative;
      ">
        <div style="
          width: 32px;
          height: 32px;
          margin-bottom: 4px;
          display: flex;
          align-items: center;
          justify-content: center;
        ">
          <svg width="28" height="28" viewBox="0 0 18 19" fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="9" cy="21" r="1"></circle>
            <circle cx="20" cy="21" r="1"></circle>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
          </svg>
        </div>
        {% if cart.item_count > 0 %}
          <span style="
            position: absolute;
            top: 2px;
            right: 50%;
            transform: translateX(50%);
            background: #FF3B30;
            color: #FFFFFF;
            border-radius: 50%;
            min-width: 16px;
            height: 16px;
            font-size: 10px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            z-index: 2;
            border: 1px solid #FFFFFF;
          ">{{ cart.item_count }}</span>
        {% endif %}
        <span style="
          font-size: 11px;
          font-weight: 500;
          line-height: 1.2;
          text-align: center;
          white-space: nowrap;
        ">Cart</span>
      </a>
    </li>

    <!-- Account -->
    <li style="display: flex; flex: 1; max-width: 80px; justify-content: center;">
      <a href="{{ routes.account_url }}" style="
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        color: #333;
        padding: 8px 4px;
        width: 100%;
        height: 64px;
      ">
        <div style="
          width: 32px;
          height: 32px;
          margin-bottom: 4px;
          display: flex;
          align-items: center;
          justify-content: center;
        ">
          <svg width="28" height="28" viewBox="0 0 18 19" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
        </div>
        <span style="
          font-size: 11px;
          font-weight: 500;
          line-height: 1.2;
          text-align: center;
          white-space: nowrap;
        ">Account</span>
      </a>
    </li>
  </ul>
</nav>

<script>
// Emergency mobile navigation fallback
document.addEventListener('DOMContentLoaded', function() {
  // Check if we're on mobile
  if (window.innerWidth <= 749) {
    // Check if main mobile nav exists and is visible
    const mainMobileNav = document.querySelector('.mobile-nav');
    const emergencyNav = document.getElementById('emergency-mobile-nav');
    
    if (!mainMobileNav || window.getComputedStyle(mainMobileNav).display === 'none') {
      // Show emergency nav if main nav doesn't exist or is hidden
      if (emergencyNav) {
        emergencyNav.style.display = 'block';
        // Add body padding
        document.body.style.paddingBottom = '98px';
      }
    }
    
    // Hide header icons
    const headerIcons = document.querySelectorAll('.header__icon--cart, .header__icon--search, .header__icon--account');
    headerIcons.forEach(icon => {
      icon.style.display = 'none';
    });
  }
});

// Handle window resize
window.addEventListener('resize', function() {
  const emergencyNav = document.getElementById('emergency-mobile-nav');
  if (window.innerWidth > 749) {
    // Hide emergency nav on desktop
    if (emergencyNav) {
      emergencyNav.style.display = 'none';
      document.body.style.paddingBottom = '0';
    }
  } else {
    // Show emergency nav on mobile if main nav is missing
    const mainMobileNav = document.querySelector('.mobile-nav');
    if (!mainMobileNav || window.getComputedStyle(mainMobileNav).display === 'none') {
      if (emergencyNav) {
        emergencyNav.style.display = 'block';
        document.body.style.paddingBottom = '98px';
      }
    }
  }
});
</script>
