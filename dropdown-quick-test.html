<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Navigation Dropdown Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .result { padding: 10px; margin: 5px 0; border-radius: 4px; }
        .pass { background: #d4edda; color: #155724; }
        .fail { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîç Navigation Dropdown Diagnostic Test</h1>
    
    <div class="test-section">
        <h2>Test Results</h2>
        <div id="results"></div>
    </div>
    
    <div class="test-section">
        <h2>Console Output</h2>
        <pre id="console-output"></pre>
    </div>

    <script>
        // Capture console output
        const originalConsole = { ...console };
        const consoleOutput = document.getElementById('console-output');
        const results = document.getElementById('results');
        
        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.textContent = message;
            results.appendChild(div);
        }
        
        function logToPage(message) {
            consoleOutput.textContent += message + '\n';
            originalConsole.log(message);
        }
        
        // Override console methods
        console.log = console.info = console.warn = console.error = logToPage;
        
        // Start diagnostic
        logToPage('üîç Starting Navigation Dropdown Diagnostic...');
        
        // Test 1: Check if NavigationController exists
        if (typeof NavigationController !== 'undefined') {
            addResult('‚úÖ NavigationController class found', 'pass');
            
            // Test 2: Check if instance exists
            if (window.navigationController) {
                addResult('‚úÖ NavigationController instance found', 'pass');
                addResult(`Initialized: ${window.navigationController.initialized}`, 'info');
            } else {
                addResult('‚ö†Ô∏è NavigationController not instantiated', 'fail');
                try {
                    window.navigationController = new NavigationController();
                    addResult('‚úÖ NavigationController manually instantiated', 'pass');
                } catch (error) {
                    addResult(`‚ùå Failed to instantiate: ${error.message}`, 'fail');
                }
            }
        } else {
            addResult('‚ùå NavigationController class not found', 'fail');
        }
        
        // Test 3: Check for dropdown elements
        const dropdowns = document.querySelectorAll('details[id^="Details-HeaderMenu-"]');
        if (dropdowns.length > 0) {
            addResult(`‚úÖ Found ${dropdowns.length} dropdown elements`, 'pass');
            
            dropdowns.forEach((dropdown, index) => {
                const summary = dropdown.querySelector('summary');
                const submenu = dropdown.querySelector('.header__submenu');
                
                if (summary && submenu) {
                    addResult(`‚úÖ Dropdown ${index + 1}: Complete structure`, 'pass');
                } else {
                    addResult(`‚ùå Dropdown ${index + 1}: Missing ${!summary ? 'summary' : 'submenu'}`, 'fail');
                }
            });
        } else {
            addResult('‚ùå No dropdown elements found', 'fail');
        }
        
        // Test 4: Check CSS rules
        const stylesheets = Array.from(document.styleSheets);
        let foundDropdownCSS = false;
        
        try {
            stylesheets.forEach(sheet => {
                try {
                    const rules = Array.from(sheet.cssRules || sheet.rules || []);
                    rules.forEach(rule => {
                        if (rule.selectorText && rule.selectorText.includes('header__submenu')) {
                            foundDropdownCSS = true;
                        }
                    });
                } catch (e) {
                    // Cross-origin or other stylesheet access issues
                }
            });
            
            if (foundDropdownCSS) {
                addResult('‚úÖ Dropdown CSS rules found', 'pass');
            } else {
                addResult('‚ö†Ô∏è Dropdown CSS rules not detected', 'fail');
            }
        } catch (error) {
            addResult(`‚ö†Ô∏è CSS check failed: ${error.message}`, 'fail');
        }
        
        // Test 5: Manual dropdown test
        setTimeout(() => {
            const firstDropdown = document.querySelector('details[id^="Details-HeaderMenu-"]');
            if (firstDropdown) {
                addResult('üß™ Testing manual dropdown toggle...', 'info');
                
                // Try to open
                firstDropdown.setAttribute('open', '');
                setTimeout(() => {
                    const isVisible = window.getComputedStyle(firstDropdown.querySelector('.header__submenu')).opacity !== '0';
                    if (isVisible) {
                        addResult('‚úÖ Dropdown opens correctly', 'pass');
                    } else {
                        addResult('‚ùå Dropdown does not become visible when opened', 'fail');
                    }
                    
                    // Close it
                    firstDropdown.removeAttribute('open');
                }, 100);
            }
        }, 1000);
        
        logToPage('üìã Diagnostic complete. Check results above.');
    </script>
</body>
</html>
